@model  Projekat.ViewModels.MaterijaliNaprednaPretragaViewModel
@{
    ViewBag.Title = "MaterijaliPrikaz";
    
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*@Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/js")*@


<div id="sredina">
    <a id="novi-materijal" href="@Url.Action("UploadMaterijal", "Materijal")">
        <img src="~/Content/img/upload.png" alt="Novi materijal">
    </a>
    <img id="banana" src="~/Content/img/potvrdaBrisanjaGIFGOTOV.gif" />


    <div id="naprednaPretraga">
        <label class="nasSelect2dropdown">Tip materijala</label>
        <select class="select2materijali" multiple="multiple" name="materijali">
            <optgroup label="Tip materijala">
                <option value="Domaci">Domaci</option>
                <option value="Predavanje">Predavanje</option>
                <option value="Vezbe">Vezbe</option>
                <option value="Primeri">Primeri</option>
            </optgroup>
        </select>


        @* //TEMP// ovde cu da bindujem sa bazom //TEMP// *@

    @*  @Html.DropDownListFor(m => m.naprednaPretragaSelektovani, new SelectList(Model.materijali), new { @class = "select2formati", @multiple = "multiple", @name ="formati" })*@

       <label class="nasSelect2dropdown">Format materijala</label>
       <select class="select2formati" multiple="multiple" name="formati">

        <optgroup label="Tekstualno">
            <option value="pdf">pdf</option>
            <option value="docx">docx</option>
            <option value="rtf">rtf</option>
            <option value="txt">txt</option>

        </optgroup>

        <optgroup label="Slike">
            <option value="jpg">jpg</option>
            <option value="gif">gif</option>
            <option value="png">png</option>
        </optgroup>

        <optgroup label="Ostalo">
            <option value="mp4">mp4</option>
        </optgroup>


    </select>
    
        @* //TEMP// ovde cu da bindujem sa bazom //TEMP// *@
        <select class="customDropdown datum" name="filterStarijeNovije">
            <option id="opadajuce">Od novijeg ka starijem</option>
            <option id="rastuce">Od starijeg ka novijem</option>           
        </select>

    </div>
    

    @foreach (var materijal in Model.materijali)
    {
        //using (Html.BeginForm("Delete", "UploadMaterijal", new { id = materijal.materijalId }))
        //{
        //}
        //var myModal = "myModal" + materijal.materijalId;
        <div class="kartica" id=@materijal.materijalId>
            <div class="karticaTekts">
                <h2>
                    @materijal.materijalNaslov
                </h2>
                <p class="postavio">
                    Jovana Nikolić / Administrator / 4 Komentara
                </p>
                <p class="opis">
                    @materijal.materijalOpis
                </p>
                <div class="kontrole">
                    <div class="triTackeKontrole" tabindex="1">
                        <img src="~/Content/img/tri-tacke.png" alt="jos-opcija">
                        <div class="dropdown-sadrzaj">
                            <a class="dropdownOpcija" href="#">Obriši</a>
                            <a class="dropdownOpcija" href="#">Uredi</a>
                            <a class="dropdownOpcija" href="#">Komentariši</a>
                        </div>
                    </div>
                    <a class="delete" href="#" data-toggle="modal" data-target="#myModal">
                        @*<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button>*@
                        @*@Url.Action("Delete", "UploadMaterijal", new { id = materijal.materijalId })*@
                        <img class="brisi" src="~/Content/img/obrisi.png" alt="obrisi">
                    </a>
                    <a class="uredi" href="#">
                        <img src="~/Content/img/uredi.png" alt="uredi">
                    </a>
                    <a class="komentarisi" href="#">
                        <img src="~/Content/img/komentarisi.png" alt="komentarisi">
                    </a>
                    <a class="datumPostavljanja" href="#">28.06.2017.</a>
                    <a class="preuzmi" href="@Url.Action("DownloadMaterijal", "Materijal", new { id = materijal.materijalId })">preuzmi</a>
                </div>
            </div>
           
            
             @*<select class="js-example-basic-single" name="state" multiple="multiple">
                <option value="AL">Alabama</option>
                
                <option value="WY">Wyoming</option>
            </select>*@
           
            
             <div class="karticaFormat">
                <a href="#">
                    <img class="imgPath" src="@Url.Content(materijal.ImgPath)" alt="preuzmi-PDF">
                </a>
            </div>
            @*@Html.HiddenFor(Model => materijal.materijalId, new {@id ="nesto" })*@
          
        </div>
    }

    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Potvrda brisanja</h4>
                </div>
                <div class="modal-body">
                    <img src="~/Content/img/kantaPotvrdaBrisanjaModal.png" id="kantaModalSlika" alt="kanta" />
                    <p>Da li ste sigurni da želite da obrišete <span></span>?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Potvrdi</button>
                    <button type="button" class="btn btn-default btn-sekundarni" data-dismiss="modal">Odustani</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    $(document).ready(function () {

        var data = sessionStorage.getItem('kantica');
        if (data) {
            $('#banana').css('display', 'block').attr('src', '').attr('src', '../../Content/img/potvrdaBrisanjaGIFGOTOV.gif');
            setTimeout(function () { $('#banana').css('display', 'none') }, 2000);
            sessionStorage.removeItem('kantica');
        }

        $(".brisi").click(function () {
            $delete = $(this);

            var id = $delete.parent().parent().parent().parent().attr('id');    
            var ime = $delete.parent().parent().parent().find('h2').text();

            console.log(id);
            $('.modal-body span').text(ime);

            $('button.btn-default:first').click(function () {
                $.ajax({
                    //url: "/ControllerName/ActionName",
                    url: '@Url.Action("DeleteConfirmed", "Materijal")' + "/?id=" + id,
                    method: 'post',
                    //data:{id:id},
                    complete: function () {
                        $delete.parent().parent().parent().parent().remove();
                        sessionStorage.setItem('kantica', true);
                        location.reload();
                    }
                });

            });
        });

    });
</script>


@Scripts.Render("~/bundles/materijal")
@Scripts.Render("~/Scripts/select2.min.js")
@Scripts.Render("~/Scripts/customDropdown.js")
@Scripts.Render("~/Scripts/filterMaterijal.js")